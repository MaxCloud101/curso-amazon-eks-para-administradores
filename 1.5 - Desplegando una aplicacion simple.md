# Introducción

En este capitulo vamos a desplegar una aplicacion simple con nginx y un balanceador de carga.

## En acción: Creando un cluster y desplegando una aplicacion simple

1.- Vamos al servio de AWS CloudShell

2.- Creamos un archivo y lo editamos con nano

```
nano demo-cluster.yaml
```

Colocamos el siguiente contenido en el archivo

```
apiVersion: eksctl.io/v1alpha5
kind: ClusterConfig

metadata:
  name: demo-cluster
  region: us-west-2

nodeGroups:
  - name: ng-1
    instanceType: t3.large
    desiredCapacity: 2
    volumeSize: 80
```
3.- Creamos el cluster con eksctl. Asi que lanzamos el siguiente comando:
```
eksctl create cluster -f demo-cluster.yaml
```
![Verificar versiones](/img/6-1.image.jpg)

4.- Revisamos los node groups del cluster
```
eksctl get nodegroups --cluster demo-cluster
```

5.- Creamos un archivo con la aplicacion y lo editamos con nano

```
nano myapp.yaml
```
Colocamos el siguiente contenido en el archivo

```
apiVersion: apps/v1
kind: Deployment
metadata:
  name: myapp
  labels:
      app: myapp
spec:
  replicas: 2
  selector:
    matchLabels:
      app: myapp
  template: 
    metadata:
      labels: 
        app: myapp
    spec:
      containers:
      - name: nginx
        image: nginx
        ports:
        - containerPort: 80

---

apiVersion: v1
kind: Service
metadata:
  name: myapp-loadbalancer
spec:
  type: LoadBalancer
  selector:
    app: myapp
  ports:
    - protocol: TCP
      port: 80
      targetPort: 80
```
6.- Lanzamos el deployment y el service siguiente comando:
```
kubectl apply -f myapp.yaml
```
7.- Esperamos unos minutos y revisamos la url del balanceador  

```
kubectl get svc
```
![Verificar versiones](/img/6-2.image.jpg)

Colocamos el external-ip en el navegador y nos mostrara el mensaje de bienvenida de nginx

![Verificar versiones](/img/6-3.image.jpg)

8.- Eliminamos la aplicacion desplegada
```
kubectl delete -f myapp.yaml
```
9.- Despues de verificar que todo este correcto eliminamos el cluster.
```
eksctl delete cluster -f demo-cluster.yaml --disable-nodegroup-eviction
```
