# Introduccion

Un add-on es un software que proporciona capacidades operativas de soporte a tu cluster de Kubernetes, pero no es específico a la aplicaciones desplegadas. 
Esto incluye software como agentes de observabilidad o controladores de Kubernetes que permiten que el clúster interactúe con los recursos de AWS para redes, computación y almacenamiento.
Los add-on suelen ser desarrollado y mantenido por la comunidad de Kubernetes, proveedores de nube como AWS o proveedores externos.

Los add-on de Amazon EKS permiten la instalación y administración de un conjunto seleccionado de complementos para clústeres de Amazon EKS. Todos incluyen los últimos parches de seguridad y correcciones de errores, y están validados por AWS para su compatibilidad con Amazon EKS. 
Los add-on de Amazon EKS te garantizan la seguridad y estabilidad de sus clústeres de Amazon EKS, reduciendo así la necesidad de instalar, configurar y actualizar complementos.

Hay 3 complementos predeterminados que se incluyen en cada clúster EKS:

- **kube-proxy:** El add-on kube-proxy se implementa en cada nodo de Amazon EC2 del clúster de Amazon EKS. Mantiene las reglas de red en los nodos y permite la comunicación de red con los pods. El add-on no se implementa en los nodos Fargate del clúster.
- **aws-node:** Este complemento es crucial para la creación de redes dentro del clúster EKS, específicamente para la forma en que los pods se comunican y reciben direcciones IP.
- **coredns:** Este es responsable de la resolución de DNS dentro de su clúster de Kubernetes. 

## Actualizacion del cluster

Un cluster manejado con eksctl puede ser actualizado en 3 pasos:

1. Actualizar la versión del **control plane** con eksctl upgrade cluster. 
2. Reemplazar cada **nodegroup** creando uno nuevo y eliminando el anterior. 
3. Actualizar los complementos predeterminados (más información aquí).
    - kube-proxy
    - aws-node
    - coredns

## En action: Actualización de un cluaster

1.- Vamos al servio de AWS CloudShell

2.- Creamos un archivo y lo editamos con nano

```
nano older-cluster.yaml
```
Colocamos el siguiente contenido en el archivo
```
apiVersion: eksctl.io/v1alpha5
kind: ClusterConfig

metadata:
  name: older-cluster
  region: us-west-2
  version: "1.30"

nodeGroups:
  - name: ng-1
    instanceType: t3.large
    desiredCapacity: 2
    volumeSize: 80
```
3.- Creamos el cluster con eksctl. Asi que lanzamos el siguiente comando:
```
eksctl create cluster -f older-cluster.yaml
```
![Verificar versiones](/img/8-1.image.jpg)

4.- Revisamos los node groups del cluster
```
eksctl get nodegroups --cluster fargate-cluster
```

5.- Editamos el archivo older-cluster.yaml
```
apiVersion: eksctl.io/v1alpha5
kind: ClusterConfig

metadata:
  name: older-cluster
  region: us-west-2
  version: "1.31"

nodeGroups:
  - name: ng-1
    instanceType: t3.large
    desiredCapacity: 2
    volumeSize: 80
```
6.- Actualizamos el cluster
```
eksctl upgrade cluster --config-file older-cluster.yaml --approve
```
![Verificar versiones](/img/8-2.image.jpg)

7.- Revisamos los node groups del cluster
```
eksctl get nodegroups --cluster fargate-cluster
```
8.- Despues de verificar que todo este correcto eliminamos el cluster.
```
eksctl delete cluster -f older-cluster.yaml --disable-nodegroup-eviction
